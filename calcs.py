import numpy as np

points = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]

forward = {
    0: [0.9426329170252411, 0.9140735604508224, 0.9774879519798982, 0.9493478946934051, 0.886929230090576],
    1: [2.869214203023538, 2.896184166415508, 2.9218140912299044, 2.800725752333555, 3.1504778752018234],
    2: [4.822955452438582, 4.887546414541777, 4.9048652432788415, 4.873378389245963, 5.038203338157492],
    3: [7.149103849979171, 6.825105239249359, 6.993060379415681, 6.96129447707575, 6.975749094856521],
    4: [8.947996278315578, 8.826005547704408, 8.95076488096912, 8.80443594777843, 9.077085565599132],
    5: [10.929336176874676, 11.088085083842497, 11.074654971117738, 11.01503258886964, 10.973347831458444],
    6: [13.190946991464946, 13.072872760153167, 12.842611909693012, 13.198458611242563, 13.09914791662066],
    7: [15.041731710202095, 14.91666371253773, 15.168575282254396, 15.155644220181467, 15.011783303759893],
    8: [17.096795270147272, 17.12383585362106, 16.914932033256708, 17.093914184912165, 17.094148111136978],
    9: [18.979837174660325, 19.16777924995022, 18.994404717531687, 18.917460265300882, 19.06753949099367],
    10: [21.10802491841826, 21.151828313670972, 20.980361825267174, 21.088619230697304, 20.814150456237456]
}

backward = {
    0: [0.9918122762492246, 1.063712733886522, 1.08040467177143, 1.172193677650502, 1.0263492421960017],
    1: [3.0673036838728565, 3.1197561776437466, 3.195341032861686, 3.1082286579398968, 2.884810810759783],
    2: [5.045822993309294, 5.12947981552949, 4.941005045019347, 5.00603173017078, 4.9840998784824935],
    3: [7.049756051584605, 7.1197716437295595, 7.1655143335872, 7.173868781558097, 7.045418512762781],
    4: [9.075042813316598, 8.951527457796457, 9.100966766158248, 9.10747459398595, 8.813502805358777],
    5: [10.820058048454099, 11.105867255372596, 11.002025369876593, 11.063609403546192, 10.9257163060419],
    6: [12.900559343292104, 12.917314308621139, 13.045257906620085, 13.064425362907324, 12.918828590525996],
    7: [15.186391329528597, 14.93127151523333, 14.930308537333751, 15.027341182259581, 15.056007638148788],
    8: [16.872403915923854, 17.0268337602181, 17.153453878534897, 17.100109125414214, 16.979762282363257],
    9: [19.030953814244477, 18.882213903249728, 18.94810787988373, 19.004184868070237, 19.05837042357785],
    10: [20.881625104808343, 21.12235995287735, 21.158802278864535, 21.02211193466849, 21.18054723685151]
}

fwd_avg = []  # armazena o valor médio em cada ponto sentido fwd
bwd_avg = []  # armazena o valor médio em cada ponto sentido bwd

repetibilidade = {}  # repetibilidade em cada ponto

for p in points:
    fwd_avg.append(float(np.mean(forward[p])))
    bwd_avg.append(float(np.mean(backward[p])))

    repetibilidade[p] = float(
        (np.max(forward[p] + backward[p]) - np.min(forward[p] + backward[p])) * 100 / (points[-1]))

print(fwd_avg)
print(bwd_avg)
print(repetibilidade)

ordem_ajuste = 2
curva_calib_estatica = np.polyfit(points, fwd_avg + bwd_avg, ordem_ajuste)
sensibilidade = np.polyder(curva_calib_estatica)

print(curva_calib_estatica)
print(sensibilidade)

valores_curva_sensibilidade = np.polyval(sensibilidade, points)

print(valores_curva_sensibilidade)

valores_curva_calib_estatica = np.polyval(curva_calib_estatica, points)
diffs = np.abs(np.array(valores_curva_calib_estatica) - np.array(fwd_avg))

Dfm = np.max(diffs)  # máxima diferença entre o ajuste feito e os dados reais

erro_ajuste = (Dfm / points[-1]) * 100  # erro de linearidade ou conformidade

if ordem_ajuste == 1:
    print(f"Erro de linearidade L(%) = {erro_ajuste:.2f}%")
else:
    print(f"Erro de conformidade C(%) = {erro_ajuste:.2f}%")

diferencas_histerese = np.abs(np.array(fwd_avg) - np.array(bwd_avg))  # diferenças ponto a ponto entre os dois sentidos
Hmax = np.max(diferencas_histerese)
erro_histerese = (Hmax / points[-1]) * 100

print(f"Erro de histerese H(%) = {erro_histerese:.2f}%")
